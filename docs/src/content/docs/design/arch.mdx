---
title: "Architecture"
description: Viber system architecture and design principles
---

import { Aside, LinkCard, CardGrid } from '@astrojs/starlight/components';

## Overview

**Viber** is an open-source Cowork Desktop that runs a team of AI agents on your local machine. It provides infrastructure for AI agents to collaborate on complex tasks with full access to local computer resources.

<Aside type="tip">
  Think of Viber as your "AI workforce" â€” specialized agents working together, running locally, connecting outward to your enterprise channels.
</Aside>

## Three-Pillar Architecture

Viber is built on three core pillars:

```mermaid
flowchart TB
    subgraph Pillars["Three Pillars"]
        Jobs["ğŸ“… Jobs<br/>Scheduled YAML cron tasks"]
        Skills["ğŸ”§ Skills<br/>SKILL.md capabilities"]
        Tools["âš™ï¸ Tools<br/>Low-level primitives"]
    end
    
    Jobs --> Scheduler
    Skills --> Registry["Skill Registry"]
    Tools --> Executor["Tool Executor"]
    
    subgraph Runtime["Viber Runtime"]
        Scheduler --> ViberAgent
        Registry --> ViberAgent
        Executor --> ViberAgent
        ViberAgent --> Agents["Worker Agents"]
    end
    
    subgraph Channels["Enterprise Channels"]
        DingTalk
        WeCom
        Web
    end
    
    ViberAgent <--> Channels
```

| Pillar | Purpose | Location |
|--------|---------|----------|
| **Jobs** | Scheduled automation (YAML cron) | `examples/jobs/` |
| **Skills** | Agent capabilities (SKILL.md) | `skills/` |
| **Tools** | Browser, file, desktop control | `src/tools/` |

## Core Components

### ViberAgent (Team Leader)

The orchestrating agent that manages plans, delegates to specialized agents, and coordinates tool execution:

```mermaid
flowchart LR
    User["User Request"] --> ViberAgent
    ViberAgent --> Planning["ğŸ“‹ Plan Creation"]
    Planning --> Delegation["ğŸ‘¥ Agent Delegation"]
    Delegation --> Tools["ğŸ”§ Tool Execution"]
    Tools --> Result["âœ… Result"]
    Result --> User
```

- **Plan Creation**: Breaks complex goals into executable steps
- **Agent Orchestration**: Delegates tasks to specialized workers
- **Tool Coordination**: Invokes tools and handles results
- **Context Management**: Maintains conversation and task history

### Worker Agents

Specialized agents designed for specific tasks:

- **Stateless Design**: No memory between invocations
- **Role Definition**: Clear purpose via system prompt
- **Tool Access**: Scoped set of available tools
- **LLM Connection**: Interface to language models

### Space (Workspace)

An isolated workspace that encapsulates:

- **Artifacts**: Generated files and outputs
- **History**: Conversation and task logs
- **Configuration**: Space-specific settings

## System Architecture

```mermaid
flowchart TB
    subgraph Channels["ğŸ“± Enterprise Channels"]
        DingTalk["é’‰é’‰<br/>DingTalk"]
        WeCom["ä¼ä¸šå¾®ä¿¡<br/>WeCom"]
        WebUI["ğŸŒ Web"]
    end
    
    subgraph Viber["ğŸ–¥ï¸ Viber Cowork Desktop"]
        subgraph AgentLayer["Agent Layer"]
            ViberAgent["ViberAgent<br/>(Leader)"]
            Workers["Worker Agents"]
        end
        
        subgraph ToolLayer["Tool Layer"]
            Browser["ğŸŒ Browser"]
            FileSystem["ğŸ“ Files"]
            MCP["ğŸ”Œ MCP"]
            Desktop["ğŸ–±ï¸ Desktop"]
        end
        
        subgraph CoreServices["Core Services"]
            Scheduler["â° Job Scheduler"]
            SkillRegistry["ğŸ“š Skill Registry"]
        end
    end
    
    subgraph Storage["ğŸ’¾ Storage"]
        Local["Local FS"]
        Supabase["Supabase"]
    end
    
    subgraph LLM["ğŸ¤– LLM Providers"]
        OpenAI["OpenAI"]
        Anthropic["Anthropic"]
        OpenRouter["OpenRouter"]
    end
    
    Channels <-->|Outbound| ViberAgent
    ViberAgent --> Workers
    Workers --> ToolLayer
    ViberAgent --> CoreServices
    ToolLayer --> Storage
    Workers <--> LLM
```

## Key Design Principles

### 1. Outbound-Only Connection

Viber connects **outward** to channels â€” no public IP or inbound ports required:

```mermaid
flowchart LR
    subgraph Local["Your Machine"]
        Viber["Viber"]
    end
    
    subgraph Cloud["Cloud Services"]
        DingTalk
        WeCom
    end
    
    Viber -->|"Outbound Poll/WebSocket"| DingTalk
    Viber -->|"Outbound Poll/WebSocket"| WeCom
```

### 2. Human-in-the-Loop

Critical for long-running vibe-working tasks:

```mermaid
flowchart TB
    Agent["Agent Working"] --> Decision{"Critical Action?"}
    Decision -->|No| Continue["Continue Autonomously"]
    Decision -->|Yes| Pause["â¸ï¸ Pause for Approval"]
    Pause --> Human["ğŸ‘¤ Human Review"]
    Human -->|Approve| Continue
    Human -->|Reject| Revise["Revise Approach"]
    Revise --> Agent
```

- **Approval Gates**: Pause before critical actions
- **Interactive Channels**: Real-time collaboration
- **Progressive Autonomy**: Start supervised, increase freedom
- **Context Handoff**: Seamless human-agent transfer

### 3. Privacy First

- 100% local execution
- Data never leaves your machine
- Your API keys, your control

### 4. Type-First Design

- Full TypeScript support
- Zod schemas for validation
- AI SDK integration

## Data Flow

```mermaid
sequenceDiagram
    participant User
    participant Channel as DingTalk/WeCom
    participant Viber as ViberAgent
    participant LLM
    participant Tools
    participant Storage as Space

    User->>Channel: Send message
    Channel->>Viber: Forward request
    Viber->>LLM: Generate plan
    LLM-->>Viber: Plan with steps
    
    loop For each step
        Viber->>LLM: Execute step
        LLM-->>Viber: Tool call
        Viber->>Tools: Execute tool
        Tools-->>Viber: Result
        Viber->>Storage: Persist artifacts
    end
    
    Viber-->>Channel: Stream response
    Channel-->>User: Display result
```

## Job Scheduling

Jobs are defined in YAML and run on a cron schedule:

```yaml
# examples/jobs/morning-standup.yaml
name: morning-standup
schedule: "0 9 * * 1-5"  # 9 AM, Mon-Fri
prompt: "Check GitHub notifications and Slack, summarize what needs attention"
model: anthropic/claude-sonnet-4-20250514
```

```mermaid
flowchart LR
    YAML["ğŸ“„ YAML Job"] --> Scheduler["â° Scheduler"]
    Scheduler -->|Cron trigger| ViberAgent
    ViberAgent --> Execute["Execute prompt"]
    Execute --> Channel["Report to channel"]
```

## Skill System

Skills are defined in `SKILL.md` files:

```markdown
---
name: git-commit
description: Stage and commit changes
parameters:
  message:
    type: string
    required: true
---
git add . && git commit -m "$message"
```

```mermaid
flowchart TB
    SkillMD["SKILL.md"] --> Parser["Parser"]
    Parser --> Registry["Skill Registry"]
    Registry --> ViberAgent
    ViberAgent -->|Tool call| Executor["Skill Executor"]
    Executor --> Shell["Run command/script"]
```

## MCP Integration

Connect to any Model Context Protocol server:

```yaml
mcp_servers:
  - name: github
    command: npx -y @modelcontextprotocol/server-github
  - name: filesystem
    command: npx -y @modelcontextprotocol/server-filesystem
```

```mermaid
flowchart LR
    Viber["ViberAgent"] --> MCPClient["MCP Client"]
    MCPClient --> GitHub["GitHub MCP"]
    MCPClient --> FS["Filesystem MCP"]
    MCPClient --> Custom["Custom MCP"]
```

## Related Documentation

<CardGrid>
  <LinkCard title="Desktop Tools" href="/design/desktop-tools" description="GUI automation with browser control" />
  <LinkCard title="Tool Execution" href="/design/tool-execution" description="Tool system design" />
  <LinkCard title="Task Lifecycle" href="/design/task-lifecycle" description="How tasks are executed" />
  <LinkCard title="Philosophy" href="/design/philosophy" description="Design principles and vision" />
</CardGrid>
